---
layout: post
title: "MPI programming with qmake"
description: ""
categories: tech
tags: [Trick]
---


## How To Utilize Qmake

*qmake* is a handy tool that is similar to *cmake* and *automake*, which is used
for generating *Makefile* automatically based on your project directory. AFAIK,
*qmake* is much easier to handle than the other two because it is has more
simple syntax. There are steps for you to use *qmake* quickly generate *Makefile*

1. under the project root directory, run `qmake -project` in the command line will generate the .pro file, which is used for generating *Makefile*

2. (optional) you can modify the .pro file, for example
    - add *include path*
    - add *link library*
    - add *compile flags*
    - etc.

3. just run `qmake` in the command line will generate the *Makefile*

--------------------------------------------

## MPI Programming
If you are programming with MPI, then you will at least include **mpi.h** in
your source file. In the compile stage, you will use **mpicc** instead of gcc to
compile the source code, because while you compile your code with **mpicc**, the
compiler will automatically add some flags, you can obtain the result if you run
`mpicc -show` in your bash. In my Linux box, the result is

{% highlight bash %}
$ mpicc -show
x86_64-pc-linux-gnu-gcc -I/usr/include -L/usr/lib64 -lmpich -lopa -lmpl
{% endhighlight %}

It add the include path and link path and the linking library.

But if you have a large project with dozen of source files, you need a Makefile
definitely. Yes, you can use *qmake* tool to generate the *Makefile*
automatically, but the default *Makefile* can't work, because the default CC is
gcc, and the default LINK is g++. You need **mpicc** instead.

------------------------------------------------------

## MPI Programming With Qmake

As I mention above, we can modify the .pro file manually. In this part, we need
to change the compiler, the linker, in addition, we may need to add some include
path and some linking library. So, let's modify the .pro file

{% highlight bash %}
...
INCLUDEPATH += . /usr/include/ # add include path here to find the header
LIBS += -L/usr/lib -lmpich     # add library and path here in the link stage
QMAKE_CC = mpicc               # replace gcc with mpicc
QMAKE_CXX = mpicxx             # replace g++ with mpicxx
QMAKE_LINK = mpicc             # change the linker, if not set it is g++
{% endhighlight %}

With the .pro file changed, you can rerun `qmake` in the command line to
generate the Makefile

----------------------------------------------------------

## Alternative Approach

Another approach is to modify the Makefile that is automatically generated by
qmake in default. You can change the compiler, linker, include path, etc.. here
directly. However, it is not an elegant approach, as the Makefile will refresh
the next time you run `qmake`
